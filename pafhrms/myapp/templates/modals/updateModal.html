<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="myModalLabel">Update Information</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
      <div class="modal-body">
        <form id="updateForm" method="post">
          {% csrf_token %}
          <input type="hidden" id="personnel_id" name="personnel_id">

                <div class="container mt-4">
                    <!-- Row 1: 4 columns of textboxes -->
                    <div class="row">
                      <div class="col-md-4">
                      <label for="lastnametxt">Last Name</label>
                      <input type="text" id="lastnametxt" name="last_name" class="form-control" placeholder="Last Name" >
                    </div>
                    <div class="col-md-3">
                      <label for="firstnametxt">First Name</label>
                      <input type="text" id="firstnametxt" name="first_name" class="form-control" placeholder="First Name" >
                    </div>
                    <div class="col-md-3">
                      <label for="middlenametxt">Middle Name</label>
                      <input type="text" id="middlenametxt" name="middle_name" class="form-control" placeholder="Middle Name" >
                    </div>
                      <div class="col-md-2">
                        <label for="textbox1">Suffix</label>
                        <input type="text" id="suffixtxt" name="suffix" class="form-control" placeholder="suffix" >
                      </div>
                    </div>
                    
                    <!-- Row 2: 5 columns of textboxes -->
                    <div class="row mt-3">
                      <div class="col-md-2">
                        <label for="textbox1">AFPSN</label>
                        <input type="text" id="afpsntxt" class="form-control" placeholder="AFPSN" disabled>
                      </div>
                      <div class="col-md-2">
                        <label for="sextxt">Sex</label>
                        <input type="text"  id="sextxt" class="form-control" placeholder="Sex" disabled>
                      </div>
                      <div class="col-md-2">
                        <label for="textbox1">Birthday</label>
                        <input type="text"  id="bdaytxt" class="form-control" placeholder="Birthday" disabled>
                      </div>
                      <div class="col-md-3">
                        <label for="textbox1">Classification</label>
                        <input type="text" id="classificationtxt"  class="form-control" placeholder="Classification" disabled>
                      </div>
                      <div class="col-md-3">
                        <label for="textbox1">Category</label>
                        <input type="text" id="categorytxt"  class="form-control" placeholder="Category" readonly >
                      </div>
                      
                      

                    </div>
                    
                    <!-- Row 3: 4 columns of textboxes -->
                    <div class="row mt-3">
                      
                      <div class="col-md-3">
                        <label for="textbox1">Date Of commission/Enlistment</label>
                        <input type="text" id="dateofcommissionshiptxt"  class="form-control" placeholder="Date Of commission/Enlistment" disabled>
                      </div>
                      
                      <div class="col-md-3">
                        <label for="textbox1">Source of Commission</label>
                        <input type="text"  id="sourceofenlistmentcommissiontxt" class="form-control" placeholder="Source of commission" disabled>
                      </div>
                      <div class="col-md-3">
                        <label for="textbox1">Date Entered to Military Service</label>
                        
                        <input type="text" id="enlistmentdatetxt"  class="form-control" placeholder="Date Entered to Military Service" disabled>
                      
                      </div>
                      <div class="col-md-3">
                        <label for="textbox1">Length Of Service</label>
                        <input type="text" id="lengthofservicetxt"  class="form-control" placeholder="Length of service" disabled>
                      </div>
                    </div>
                  </div>

                  <div class="container mt-4">
                    <!-- Row 1: 4 columns of textboxes -->
                    <div class="row">
                      <div class="col-md-12">
                        <label for="addresstxt">Address</label>
                        <input type="text"  id="addresstxt" class="form-control" name="address" placeholder="Address">
                      </div>

                    
                    </div>
                    
                    <!-- Row 2: 5 columns of textboxes -->
                    <div class="row mt-3">
                      <div class="col-md-1">
                        <label>Rank</label>
                        <input type="text"  id="ranktxt" name = "rank" class="form-control" >


                        <!-- <select for="ranktxt" id="ranktxt" name = 'rank ' class="form-control">
                          <option selected>Rank</option>
                          <optgroup label="Officer">
                            <option >GEN</option>
                            <option >LTGEN</option>
                            <option >BGEN</option>
                            <option >COL</option>
                            <option >LTC</option>
                            <option >MAJ</option>
                            <option >CPT</option>
                            <option >1LT</option>
                            <option >2LT</option>
                          </optgroup>
                          <optgroup label="Enlisted Personnel">
                            <option >CMSgt</option>
                            <option >SMSgt</option>
                            <option >MSgt</option>
                            <option >TSg</option>
                            <option >SSg</option>
                            <option >Sgt</option>
                            <option >A1C</option>
                            <option >AW1C</option>
                            <option >A2C</option>
                            <option >AW2C</option>
                            <option >AM</option>
                            <option >AW</option>
                          </optgroup>
                        </select> -->


                      </div>
                      <div class="col-md-2">
                        <label for="afsctxt">AFSC</label>
                        <input type="text"  id="afsctxt" name="afsc"  class="form-control" placeholder="AFSC">
                      </div>
                      <div class="col-md-2">
                        <label >Unit</label>
                        <select for="unitDP" id="unitDP" name="unit" class="form-control">
                        <option selected>UNIT</option>
                        <option>GHQ</option>
                        <option>HPAF</option>
                        <option>PAFHRMC-A/U</option>
                        <option>PAFHRMC</option>
                        <option>AFPWSSUS</option>
                        <option>AIBDC</option>
                        <option>ADC</option>
                        <option>AMC</option>
                        <option>ACC</option>
                        <option>AETDC</option>
                        <option>ARFC</option>
                        <option >TOWNOL</option>
                        <option >TOWSOL</option>
                        <option >TOWCEN</option>
                        <option >TOWWEST</option>
                        <option >TOWEASTMIN</option>
                        <option >TOWWESTMIN</option>
                        <option >355AEW</option>
                        <option >300AISW</option>
                        <option >900AFWG</option>
                        <option >950CEWW</option>
                        <option >AFFC</option>
                        <option >AFSSG</option>
                        <option >HSSG</option>
                        <option >PAFCMOG</option>
                        <option >PAFHRMC</option>
                        <option >NOLCOM</option>
                        <option >SOLCOM</option>
                        <option >WESCOM</option>
                        <option >VISCOM</option>
                        <option >WESTMINCOM</option>
                        <option >EASTMINCOM</option>
                        <option >JTF-NCR</option>
                        </select>
                      </div>
                      <div class="col-md-2">
                        <label>Sub Unit</label>
                        <select for="SubunitDP" id="SubunitDP"  name="subunit" class="form-control">
                        <option selected>SUB UNIT</option>
                      </select>
                      </div>

                      <div class="col-md-2">
                        <label>Highest PME</label>
                        <input type="text" name="hpme"  id="hpmetxt" class="form-control" placeholder="Highest PME">
                    </div>  
                    <div class="col-md-3">
                      <label for="contactnumtxt">Contact Number</label>
                      <input type="text" name="contactnum" id="contactnumtxt"  oninput="validateNumberInput(this)" class="form-control" maxlength="11" placeholder="e.g 09123456789" >
                    </div>
                  </div>  
                    <!-- Row 3: 4 columns of textboxes -->
                    <div class="row mt-3">
                        <!-- <select for="hpmetxt" id="hpmetxt" name = 'hpme ' class="form-control">
                          <option selected>Rank</option>
                          <optgroup label="Officer">
                            <option >GEN</option>
                            <option >LTGEN</option>
                            <option >BGEN</option>
                            <option >COL</option>
                            <option >LTC</option>
                            <option >MAJ</option>
                            <option >CPT</option>
                            <option >1LT</option>
                            <option >2LT</option>
                          </optgroup>
                          <optgroup label="Enlisted Personnel">
                            <option >CMSgt</option>
                            <option >SMSgt</option>
                            <option >MSgt</option>
                            <option >TSg</option>
                            <option >SSg</option>
                            <option >Sgt</option>
                            <option >A1C</option>
                            <option >AW1C</option>
                            <option >A2C</option>
                            <option >AW2C</option>
                            <option >AM</option>
                            <option >AW</option>
                          </optgroup>
                        </select> -->
                      <div class="col-md-3">
                        <label for="promotiontxt">Date of Last Promotion</label>
                        <input type="text" name="promotion" id="promotiontxt" class="form-control">
                      </div>
                      <div class="col-md-3">
                        <label for="dateoflastetadsot">Date Of Last ETAD/SOT</label>
                        <input type="text" name="dateoflastetadsot" id="dateoflastetadsottxt" class="form-control" placeholder="Date of last ETAD/SOT" >
                      </div>
                      <div class="col-md-3">
                        <label for="">Date of 1st Tranche</label>
                          <input type="text" name="unaTranche" id="unaTranchetxt"   class="form-control"  placeholder="Date of 1st Tranche" >
                      </div>
                      <div class="col-md-3">
                        <label for="">Date of 2nd Tranche</label>
                          <input type="text" name="dosTranche" id="dosTranchetxt"   class="form-control"  placeholder="Date of 2nd Tranche" >
                      </div>
                    </div>
                  </div>
                </div>
                <div class="modal-footer">
                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                  <button type="submit" class="btn btn-primary">Save changes</button>
            </form>
        </div>
      </div>
    </div>
  </div>


  <script>
    function validateNumberInput(input) {
            // Remove any non-digit characters
            input.value = input.value.replace(/\D/g, '');
        }



        $(document).ready(function() {
  $('.openModalButton').click(function() {
    var personnelId = $(this).data('afpsn'); // Assuming 'afpsn' is the unique identifier
    var address = $(this).data('address');
    var classification = $(this).data('classification');

    var category = $(this).data('category');
    var rank = $(this).data('rank');
    var suffix = $(this).data('suffix');
    
    var afsc = $(this).data('afsc');
    var unit = $(this).data('unit');
    var subunit = $(this).data('subunit');
    var contactnum = $(this).data('contactnum');
    var hpme = $(this).data('hpme');
    var promotion = $(this).data('promotion');

    var unaTranche = $(this).data('unaTranche');
    var dosTranche = $(this).data('dosTranche');
    var dateoflastetadsot = $(this).data('dateoflastetadsot');


    $('#personnel_id').val(personnelId);
    // $('#firstnametxt').val(firstname);
    // $('#middlenametxt').val(middlename);
    // $('#lastnametxt').val(lastname);
    $('#suffixtxt').val(suffix);
    

    $('#addresstxt').val(address);
    $('#categorytxt').val(category);
    $('#classificationtxt').val(classification);
    
    $('#ranktxt').val(rank);
    $('#afsctxt').val(afsc);
    $('#unitDP').val(unit);
    $('#contactnumtxt').val(contactnum);
    $('#hpmetxt').val(hpme);
    $('#unaTranchetxt').val(unaTranche);
    $('#dosTranchetxt').val(dosTranche);
    $('#dateoflastetadsottxt').val(dateoflastetadsot);

    // Populate the subunit dropdown based on the selected unit
    populateSubunits(unit, subunit);

    $('#updateForm').submit(function(event) {
      event.preventDefault();
      
      var formData = $(this).serialize();
      var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();

      $.ajax({
        url: '{% url "update_personnel" %}',
        method: 'POST',
        data: formData,
        headers: {
          'X-CSRFToken': csrfToken
        },
        success: function(response) {
          if (response.success) {
            console.log('Data updated successfully!');
            location.reload(); // Reload page or update UI as needed
          } else {
            console.error('Error updating data:', response.error);
          }
        },
        error: function(xhr, status, error) {
          console.error('Error updating data:', error);
        }
      });
    });
  });

  // Function to populate subunits based on the selected unit
  function populateSubunits(unit, selectedSubunit) {
    const unitSubunitMap = {
      'HPAF': ['OCG', 'OVC', 'OCAS', 'OSAS', 'AFCC', 'OAFIG', 'OSS', 'AFSO', 'OESPA','AFSMO', 'AFPAO', 'OAFIA', 'OAFSM', 'OAFA', 'OAFPM', 'OAJA', 'OCAC','OCSAF', 'OCAFDS', 'OCNAF', 'OAFCE', 'OCHCA', 'AFREO', 'AFIMAO','AFCLOAC', 'OAFGAD', 'ACOFAS, A-1', 'ACOFAS, A-2', 'ACOFAS, A-3','ACOFAS, A-4', 'ACOFAS, A-5', 'ACOFAS, A-6', 'ACOFAS, A-7', 'ACOFAS, A-8','ACOFAS, A-9', 'ACOFAS, A-10'],
      'AIBDC':  ['HAIBDC', '520th ABG', '530th ABG', '540th ABG', '550th ABG','560th ABG', '585th ABG', '590th ABG', '600ABG', '970th HECG','AFGH', '1301st DD'],
      'ADC': ['HADC', '5FW', '580ACWW', '960AMDG', 'PADCC', 'ADAC'],
      'AMC':['HAMC', '205THW', '220AW', '250PAW', '505SRG'],
      'ACC': ['HACC', '15SW', '710SPOW'],
      'AETDC': [ 'HAETDC', 'PAFOS', 'PAFOCS', 'PAFFS', 'PAFNCOS', 'PAFTSS','PAFBMS', 'PAFLTC', 'PAFALEN', '440AMG', 'TDC', 'AWC'],
      'ARFC': ['HAFRC', '1st ARCEN', '2nd ARCEN', '3rd ARCEN', '4th ARCEN', '5th ARCEN', '6th ARCEN', '7th ARCEN', '8th ARCEN'],  
      'GHQ': ['OJ1', 'OJ2', 'OJ3', 'OJ4', 'OJ5', 'OJ6', 'OJ7', 'OJ8', 'OJ9', 'OJ10', 'AFPCC','OTAG', 'OTPMG', 'OTCCHS', 'OTJAG', 'AFPPDO', 'OTQMG', 'OTSG', 'AFPSEO','AFPHRO', 'OTCN', 'OTCDS', 'OSPS', 'AFPIMAC', 'AFPREO', 'AFPEBSO', 'OTCE','AFP K9', 'AFPCOC', 'CEISO', 'CGEASH', 'OAFPSM', 'GHQTS', 'PMO', 'OSJA','ODCOP', 'ONAF', 'GHQPFO'],
      'AFPWSSUS': ['PMA', 'AFPETDC', 'CEISSAFP', 'CRSAFP', 'ISAFP', 'AFPHSC', 'AFP SOCOM', 'AFPFC', 'AFPPS', 'AFPPKOC', 'AFPCES', 'AFPMCC', 'PSG', 'AFPPGMC', 'AFPCYBER', 'AFPRESCOM', 'DND'],
    };

    const subunitDP = document.getElementById('SubunitDP');
    subunitDP.innerHTML = '<option value="">--Select Subunit--</option>';

    if (unit) {
      const subunits = unitSubunitMap[unit];
      if (subunits) {
        subunits.forEach(function(subunit) {
          const option = document.createElement('option');
          option.value = subunit;
          option.textContent = subunit;
          subunitDP.appendChild(option);
        });
      }
    }

    if (selectedSubunit) {
      $('#SubunitDP').val(selectedSubunit);
    }
  }

  // Event listener for unit dropdown change
  $('#unitDP').change(function() {
    const selectedUnit = $(this).val();
    const selectedSubunit = $('#SubunitDP').val(); // Get the current value of subunit
    populateSubunits(selectedUnit, selectedSubunit); // Pass current subunit value to maintain selection
  });

  // Validate number input
  function validateNumberInput(input) {
    input.value = input.value.replace(/\D/g, '');
  }

  $('#contactnumtxt').on('input', function() {
    validateNumberInput(this);
  });
});


  </script>